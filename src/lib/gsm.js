// SMS is limited to basically ASCII -- special chars can inflate segment count
// and therefore cost, quite a bit. This replaces common non-ascii versions of ascii chars (e.g. smart quotes)
// to their ascii equivalents. Spoke does this both during script editing and also message sending

export const GSM_REPLACEMENTS = getGsmReplacements();

const genRegex = () => {
  const inputs = Object.keys(GSM_REPLACEMENTS);
  const matchable = "\\u" + inputs.join("|\\u");
  const rx = new RegExp(matchable, "ugm");
  return rx;
};

export const GSM_REPL_REGEX = genRegex();

export const replaceEasyGsmWins = text => {
  // TODO: consider not replacing when it's already an MMS (with an image url)
  return text.replace(GSM_REPL_REGEX, specialChar => {
    const unicodeHex = specialChar
      .charCodeAt(0)
      .toString(16)
      .toUpperCase()
      .padStart(4, "0");
    return GSM_REPLACEMENTS[unicodeHex] || specialChar;
  });
};

// From https://www.twilio.com/docs/messaging/services/smart-encoding-char-list
export function getGsmReplacements() {
  // make this a function so it can be on the bottom of the file
  return {
    "00AB": '"',
    "00BB": '"',
    "201C": '"',
    "201D": '"',
    "02BA": '"',
    "02EE": '"',
    "201F": '"',
    "275D": '"',
    "275E": '"',
    "301D": '"',
    "301E": '"',
    FF02: '"',
    "2018": "'",
    "2019": "'",
    "02BB": "'",
    "02C8": "'",
    "02BC": "'",
    "02BD": "'",
    "02B9": "'",
    "201B": "'",
    FF07: "'",
    "00B4": "'",
    "02CA": "'",
    "0060": "' ",
    "02CB": "' ",
    "275B": "' ",
    "275C": "'",
    "0313": "' ",
    "0314": "' ",
    FE10: "' ",
    FE11: "' ",
    "00F7": "/",
    "00BC": "1/4",
    "00BD": "1/2",
    "00BE": "3/4",
    "29F8": "/",
    "0337": "/",
    "0338": "/",
    "2044": "/",
    "2215": "/",
    FF0F: "/",
    "29F9": "\\",
    "29F5": "\\",
    "20E5": "\\",
    FE68: "\\",
    FF3C: "\\",
    "0332": "_",
    FF3F: "_",
    "20D2": "|",
    "20D3": "|",
    "2223": "|",
    FF5C: "|",
    "23B8": "|",
    "23B9": "|",
    "23D0": "|",
    "239C": "|",
    "239F": "|",
    "23BC": "-",
    "23BD": "-",
    "2015": "-",
    FE63: "-",
    FF0D: "-",
    "2010": "-",
    "2022": "-",
    "2043": "-",
    FE6B: "@",
    FF20: "@",
    FE69: "$",
    FF04: "$",
    "01C3": "!",
    FE15: "!",
    FE57: "!",
    FF01: "!",
    FE5F: "#",
    FF03: "#",
    FE6A: "%",
    FF05: "%",
    FE60: "&",
    FF06: "&",
    "201A": " ,",
    "0326": " ,",
    FE50: " ,",
    "3001": ",",
    FE51: ",",
    FF0C: ", ",
    FF64: ", ",
    "2768": "(",
    "276A": "(",
    FE59: "(",
    FF08: "(",
    "27EE": "(",
    "2985": "(",
    "2769": ")",
    "276B": ")",
    FE5A: ")",
    FF09: ")",
    "27EF": ")",
    "2986": ")",
    "204E": "*",
    "2217": "*",
    "229B": "*",
    "2722": "*",
    "2723": "*",
    "2724": "*",
    "2725": "*",
    "2731": "*",
    "2732": "*",
    "2733": "*",
    "273A": "*",
    "273B": "*",
    "273C": "*",
    "273D": "*",
    "2743": "*",
    "2749": "*",
    "274A": "*",
    "274B": "*",
    "29C6": "*",
    FE61: "*",
    FF0A: "*",
    "02D6": "+",
    FE62: "+",
    FF0B: "+",
    "3002": ".",
    FE52: ".",
    FF0E: ".",
    FF61: ".",
    FF10: "0",
    FF11: "1",
    FF12: "2",
    FF13: "3",
    FF14: "4",
    FF15: "5",
    FF16: "6",
    FF17: "7",
    FF18: "8",
    FF19: "9",
    "02D0": ": ",
    "02F8": ": ",
    "2982": ": ",
    A789: ": ",
    FE13: " :",
    FF1A: ": ",
    "204F": ";",
    FE14: ";",
    FE54: ";",
    FF1B: ";",
    FE64: "<",
    FF1C: "<",
    "0347": "=",
    A78A: "=",
    FE66: "=",
    FF1D: "=",
    FE65: ">",
    FF1E: ">",
    FE16: "?",
    FE56: "?",
    FF1F: "?",
    FF21: "A",
    "1D00": "A",
    FF22: "B",
    "0299": "B",
    FF23: "C",
    "1D04": "C",
    FF24: "D",
    "1D05": "D",
    FF25: "E",
    "1D07": "E",
    FF26: "F",
    A730: "F",
    FF27: "G",
    "0262": "G",
    FF28: "H",
    "029C": "H",
    FF29: "I",
    "026A": "I",
    FF2A: "J",
    "1D0A": "J",
    FF2B: "K",
    "1D0B": "K",
    FF2C: "L",
    "029F": "L",
    FF2D: "M",
    "1D0D": "M",
    FF2E: "N",
    "0274": "N",
    FF2F: "O",
    "1D0F": "O",
    FF30: "P",
    "1D18": "P",
    FF31: "Q",
    FF32: "R",
    "0280": "R",
    FF33: "S",
    A731: "S",
    FF34: "T",
    "1D1B": "T",
    FF35: "U",
    "1D1C": "U",
    FF36: "V",
    "1D20": "V",
    FF37: "W",
    "1D21": "W",
    FF38: "X",
    FF39: "Y",
    "028F": "Y",
    FF3A: "Z",
    "1D22": "Z",
    "02C6": "^",
    "0302": "^",
    FF3E: "^",
    "1DCD": "^",
    "2774": "{",
    FE5B: "{",
    FF5B: "{",
    "2775": "}",
    FE5C: "}",
    FF5D: "}",
    FF3B: "[",
    FF3D: "]",
    "02DC": "~",
    "02F7": "~",
    "0303": "~",
    "0330": "~",
    "0334": "~",
    "223C": "~",
    FF5E: "~",
    "00A0": "'",
    "2000": "'",
    "2001": " ",
    "2002": " ",
    "2003": " ",
    "2004": " ",
    "2005": " ",
    "2006": " ",
    "2007": " ",
    "2008": " ",
    "2009": " ",
    "200A": " ",
    "200B": " ",
    "202F": " ",
    "205F": " ",
    "3000": " ",
    FEFF: " ",
    "008D": " ",
    "009F": " ",
    "0080": " ",
    "0090": " ",
    "009B": " ",
    "0010": " ",
    "0009": " ",
    "0000": " ",
    "0003": " ",
    "0004": " ",
    "0017": " ",
    "0019": " ",
    "0011": " ",
    "0012": " ",
    "0013": " ",
    "0014": " ",
    "2017": "_",
    "2014": "-",
    "2013": "-",
    "201A": "' ",
    "202F": " ",
    "2039": ">",
    "203A": "<",
    "203C": "!!",
    "201E": '"',
    "201D": '"',
    "201C": '"',
    "201B": " '",
    "2026": "... ",
    "2028": " ",
    "2029": " ",
    "205F": " ",
    "2060": " "
  };
}
